\documentclass[12pt,a4paper]{report}
\usepackage[utf8]{inputenc}
\usepackage[french]{babel}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{geometry}
\usepackage{hyperref}
\usepackage{xcolor}
\usepackage{listings}
\usepackage{tcolorbox}
\usepackage{fancyhdr}
\usepackage{titlesec}
\usepackage{enumitem}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{tikz}
\usepackage{float}

% Configuration de la page
\geometry{
    top=2.5cm,
    bottom=2.5cm,
    left=3cm,
    right=2.5cm
}

% Configuration des liens
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    filecolor=magenta,      
    urlcolor=cyan,
    pdftitle={VMManager - CreateVM \& DetailsVM},
    pdfpagemode=FullScreen,
}

% Configuration des listings de code
\lstset{
    basicstyle=\ttfamily\small,
    keywordstyle=\color{blue}\bfseries,
    commentstyle=\color{gray}\itshape,
    stringstyle=\color{red},
    numbers=left,
    numberstyle=\tiny\color{gray},
    stepnumber=1,
    numbersep=10pt,
    backgroundcolor=\color{white},
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    frame=single,
    rulecolor=\color{black},
    tabsize=2,
    captionpos=b,
    breaklines=true,
    breakatwhitespace=false,
    title=\lstname,
    escapeinside={\%*}{*)},
    morekeywords={*,...}
}

% En-t√™tes et pieds de page
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\leftmark}
\fancyhead[R]{VMManager - CreateVM \& DetailsVM}
\fancyfoot[C]{\thepage}

% Couleurs personnalis√©es
\definecolor{primaryblue}{RGB}{33,150,243}
\definecolor{darkblue}{RGB}{13,71,161}
\definecolor{lightgray}{RGB}{245,245,245}

% Style des titres
\titleformat{\chapter}[display]
{\normalfont\huge\bfseries\color{darkblue}}
{\chaptertitlename\ \thechapter}{20pt}{\Huge}

\titleformat{\section}
{\normalfont\Large\bfseries\color{primaryblue}}
{\thesection}{1em}{}

% Bo√Ætes color√©es
\newtcolorbox{infobox}{
    colback=blue!5!white,
    colframe=blue!75!black,
    title=Information
}

\newtcolorbox{warningbox}{
    colback=orange!5!white,
    colframe=orange!75!black,
    title=Attention
}

\newtcolorbox{successbox}{
    colback=green!5!white,
    colframe=green!75!black,
    title=Succ√®s
}

% D√©but du document
\begin{document}

% ============================================================
% PAGE DE GARDE
% ============================================================
\begin{titlepage}
    \centering
    \vspace*{2cm}
    
    {\Huge\bfseries VMManager - CreateVM\par}
    \vspace{0.5cm}
    {\Large Fonctionnalit√© de Cr√©ation de Machines Virtuelles\par}
    
    \vspace{2cm}
    
    {\LARGE\bfseries Documentation Technique\par}
    {\Large Interface de Cr√©ation et D√©tails de VMs Proxmox\par}
    
    \vspace{3cm}
    
    \begin{tabular}{rl}
        \textbf{Formation :} & EPSI - Administration R√©seaux \\
        \textbf{Ann√©e :} & 2025-2026 \\
        \textbf{Fonctionnalit√© :} & CreateVM \\
        \textbf{Technologies :} & Symfony 7, PHP 8.2, JavaScript, Proxmox VE \\
    \end{tabular}
    
    \vfill
    
    {\large \today\par}
\end{titlepage}

% ============================================================
% TABLE DES MATI√àRES
% ============================================================
\tableofcontents
\newpage

% ============================================================
% CHAPITRE 1 : PR√âSENTATION DES FONCTIONNALIT√âS
% ============================================================
\chapter{Pr√©sentation de la Fonctionnalit√© CreateVM}

\section{Contexte et Objectifs}

\subsection{Contexte}

La fonctionnalit√© \textbf{CreateVM} constitue le c≈ìur de la plateforme VMManager, permettant la cr√©ation de nouvelles machines virtuelles sur une infrastructure Proxmox VE.

Cette fonctionnalit√© r√©pond au besoin critique de provisionnement rapide et automatis√© de ressources virtuelles dans un environnement d'entreprise.

\subsection{Objectifs de la Fonctionnalit√©}

Les objectifs principaux sont :

\begin{itemize}[leftmargin=2cm]
    \item \textbf{Interface intuitive} : Formulaire moderne pour la cr√©ation de VMs
    \item \textbf{Configuration flexible} : Ressources personnalisables (CPU, RAM, disque)
    \item \textbf{Validation robuste} : Contr√¥les c√¥t√© client et serveur
    \item \textbf{Int√©gration Proxmox} : Communication transparente avec l'infrastructure
    \item \textbf{Exp√©rience utilisateur} : Processus de cr√©ation fluide et rapide
\end{itemize}

\subsection{Architecture des Modes}

L'application fonctionne selon deux modes distincts :

\begin{center}
\begin{tikzpicture}[node distance=2cm]
    % Nodes
    \node[draw, rectangle, fill=blue!20, minimum width=4cm, minimum height=1cm] (demo) {Mode D√©monstration};
    \node[draw, rectangle, fill=green!20, minimum width=4cm, minimum height=1cm, right of=demo, xshift=3cm] (dynamic) {Mode Dynamique};
    
    % Sub-nodes for demo
    \node[draw, rectangle, fill=blue!10, minimum width=3cm, minimum height=0.8cm, below of=demo, yshift=-0.5cm] (demo-data) {Donn√©es statiques};
    \node[draw, rectangle, fill=blue!10, minimum width=3cm, minimum height=0.8cm, below of=demo-data] (demo-ui) {Interface compl√®te};
    
    % Sub-nodes for dynamic
    \node[draw, rectangle, fill=green!10, minimum width=3cm, minimum height=0.8cm, below of=dynamic, yshift=-0.5cm] (dynamic-api) {API Backend};
    \node[draw, rectangle, fill=green!10, minimum width=3cm, minimum height=0.8cm, below of=dynamic-api] (dynamic-real) {Donn√©es temps r√©el};
    
    % Arrows
    \draw[->, thick] (demo) -- node[above] {Migration} (dynamic);
\end{tikzpicture}
\end{center}

% ============================================================
% CHAPITRE 2 : MODE D√âMONSTRATION
% ============================================================
\chapter{Mode D√©monstration}

\section{Pr√©sentation du Mode D√©monstration}

\subsection{Caract√©ristiques}

Le mode d√©monstration utilise des \textbf{donn√©es statiques} int√©gr√©es directement dans le contr√¥leur PHP pour permettre une d√©monstration imm√©diate des fonctionnalit√©s sans d√©pendance d'un serveur backend.

\begin{infobox}
\textbf{Avantages du mode d√©monstration :}
\begin{itemize}
    \item D√©monstration imm√©diate des fonctionnalit√©s
    \item Aucune configuration serveur requise
    \item Interface compl√®te et fonctionnelle
    \item Parfait pour les pr√©sentations
\end{itemize}
\end{infobox}

\subsection{Comportement sans Serveur Backend}

En mode dynamique sans serveur backend, l'application affiche un \textbf{loader qui tourne ind√©finiment}, car :

\begin{itemize}
    \item Les appels API √©chouent (serveur non disponible)
    \item Le JavaScript tente de se connecter en boucle
    \item L'interface reste en √©tat de chargement
    \item Aucune donn√©e n'est affich√©e
\end{itemize}

\begin{warningbox}
\textbf{Probl√®me du mode dynamique sans backend :}
Sans serveur API, l'application reste bloqu√©e sur l'√©cran de chargement avec un spinner qui tourne sans fin, rendant l'interface inutilisable.
\end{warningbox}

\section{Impl√©mentation du Mode D√©monstration}

\subsection{Contr√¥leur avec Donn√©es Statiques}

\begin{lstlisting}[language=PHP, caption=Contr√¥leur en mode d√©monstration]
#[Route('/vm/{vmid}', name: 'app_vm_details')]
public function details(int $vmid): Response
{
    // Donn√©es VM en dur pour la d√©monstration
    $vmData = [
        'vmid' => $vmid,
        'name' => 'web-01',
        'status' => 'running',
        'node' => 'proxmox-01',
        'cpus' => 2,
        'maxmem' => 4294967296, // 4GB en bytes
        'mem' => 2147483648, // 2GB utilis√©s
        'maxdisk' => 53687091200, // 50GB en bytes
        'disk' => 10737418240, // 10GB utilis√©s
        'uptime' => 86400, // 1 jour en secondes
        'cpu' => 0.25, // 25% CPU
        'netin' => 104857600, // 100MB
        'netout' => 52428800, // 50MB
    ];

    // Donn√©es des snapshots en dur
    $snapshots = [
        [
            'name' => 'snapshot-2025-10-15-01',
            'snaptime' => 1728990600,
            'description' => 'Avant mise √† jour syst√®me',
            'size' => 2684354560
        ],
        // ... autres snapshots
    ];

    // Donn√©es des √©v√©nements en dur
    $events = [
        [
            'date' => '15/10/2025 14:23',
            'type' => 'info',
            'message' => 'VM d√©marr√©e',
            'user' => 'admin'
        ],
        // ... autres √©v√©nements
    ];

    return $this->render('vm/details.html.twig', [
        'vm' => $vmData,
        'snapshots' => $snapshots,
        'events' => $events,
    ]);
}
\end{lstlisting}

\subsection{Template Simplifi√©}

\begin{lstlisting}[language=HTML, caption=Template en mode d√©monstration]
<!-- Affichage direct des donn√©es statiques -->
<div class="vm-info-card">
    <h1>{{ vm.name }}</h1>
    <span class="vm-status-badge {{ vm.status }}">
        {% if vm.status == 'running' %}‚óè En cours{% else %}‚óè Arr√™t√©e{% endif %}
    </span>
    <div class="vm-specs">
        <div class="vm-spec-item">
            <div class="vm-spec-label">Node</div>
            <div class="vm-spec-value">{{ vm.node }}</div>
        </div>
        <!-- ... autres informations -->
    </div>
</div>

<!-- Donn√©es des snapshots -->
{% for snapshot in snapshots %}
<tr>
    <td><strong>{{ snapshot.name }}</strong></td>
    <td>{{ snapshot.snaptime|date('d/m/Y H:i') }}</td>
    <td>{{ snapshot.description }}</td>
</tr>
{% endfor %}
\end{lstlisting}

% ============================================================
% CHAPITRE 3 : FONCTIONNALIT√â CREATEVM
% ============================================================
\chapter{Fonctionnalit√© CreateVM}

\section{Interface de Cr√©ation}

\subsection{Formulaire en 3 Sections}

La page de cr√©ation propose un formulaire structur√© :

\subsubsection{Section 1 : Informations G√©n√©rales}

\begin{itemize}
    \item \textbf{Nom de la VM} : Champ texte obligatoire
    \item \textbf{Syst√®me d'exploitation} : S√©lection visuelle parmi 6 options :
    \begin{itemize}
        \item Ubuntu 22.04 (üêß)
        \item Debian 12 (üåÄ)
        \item CentOS 9 (üî¥)
        \item Windows Server (ü™ü)
        \item Alpine Linux (üèîÔ∏è)
        \item Custom ISO (‚öôÔ∏è)
    \end{itemize}
\end{itemize}

\subsubsection{Section 2 : Configuration des Ressources}

Configuration via des cartes interactives avec sliders :

\begin{table}[H]
\centering
\begin{tabular}{@{}llll@{}}
\toprule
\textbf{Ressource} & \textbf{Minimum} & \textbf{Maximum} & \textbf{D√©faut} \\ \midrule
CPU (vCPU) & 1 & 16 & 2 \\
RAM (GB) & 1 & 64 & 4 \\
Disque (GB) & 10 & 500 & 32 \\ \bottomrule
\end{tabular}
\caption{Configuration des ressources CreateVM}
\end{table}

\subsubsection{Section 3 : Configuration R√©seau}

\begin{itemize}
    \item \textbf{Bridge r√©seau} : vmbr0, vmbr1, vmbr2, vmbr3
    \item \textbf{Adresse IP} : DHCP automatique ou IP statique
\end{itemize}

\subsection{R√©capitulatif Dynamique}

Affichage en temps r√©el de la configuration s√©lectionn√©e :

\begin{itemize}
    \item OS s√©lectionn√© avec ic√¥ne
    \item Configuration CPU/RAM/Disque
    \item Param√®tres r√©seau
\end{itemize}

% ============================================================
% CHAPITRE 4 : IMPL√âMENTATION TECHNIQUE
% ============================================================
\chapter{Impl√©mentation Technique}

\section{Architecture Frontend}

\subsection{Structure des Fichiers}

\begin{lstlisting}[language=bash, caption=Structure des fichiers CreateVM]
templates/vm/
‚îî‚îÄ‚îÄ create.html.twig          # Template principal
src/Controller/
‚îî‚îÄ‚îÄ ListVMsController.php     # Route /vm/create
assets/
‚îú‚îÄ‚îÄ app.js                     # Logique JavaScript
‚îî‚îÄ‚îÄ styles/
    ‚îî‚îÄ‚îÄ app.css               # Styles personnalis√©s
\end{lstlisting}

\subsection{Contr√¥leur Symfony}

\begin{lstlisting}[language=PHP, caption=Route de cr√©ation de VM]
#[Route('/vm/create', name: 'app_vm_create')]
public function create(): Response
{
    return $this->render('vm/create.html.twig');
}
\end{lstlisting}

\section{Validation JavaScript}

\subsection{Validation des Champs}

\begin{lstlisting}[language=JavaScript, caption=Validation du formulaire]
function validateForm() {
    const name = document.getElementById('vm-name').value;
    const os = document.getElementById('vm-os').value;
    const cpu = parseInt(document.getElementById('vm-cpu').value);
    const ram = parseInt(document.getElementById('vm-ram').value);
    const disk = parseInt(document.getElementById('vm-disk').value);
    const bridge = document.getElementById('vm-bridge').value;
    
    // Validation du nom
    if (!name || name.length < 3) {
        showError('Le nom de la VM doit contenir au moins 3 caract√®res');
        return false;
    }
    
    // Validation des ressources
    if (cpu < 1 || cpu > 16) {
        showError('Le nombre de CPU doit √™tre entre 1 et 16');
        return false;
    }
    
    if (ram < 1 || ram > 64) {
        showError('La RAM doit √™tre entre 1 et 64 GB');
        return false;
    }
    
    if (disk < 10 || disk > 500) {
        showError('L\'espace disque doit √™tre entre 10 et 500 GB');
        return false;
    }
    
    return true;
}
\end{lstlisting}

% ============================================================
% CHAPITRE 5 : MIGRATION VERS LE MODE DYNAMIQUE
% ============================================================
\chapter{Migration vers le Mode Dynamique}

\section{Pr√©paration du Mode Dynamique}

\subsection{Architecture Pr√™te}

L'application est con√ßue pour supporter facilement le passage au mode dynamique :

\begin{itemize}
    \item \textbf{Service API JavaScript} : D√©j√† impl√©ment√©
    \item \textbf{Endpoints backend} : Structure pr√©par√©e
    \item \textbf{Gestion JWT} : Authentification pr√™te
    \item \textbf{Flux d'√©v√©nements} : SSE configur√©
\end{itemize}

\subsection{Composants √† Activer}

\begin{enumerate}
    \item \textbf{Service API} : D√©commenter le code JavaScript
    \item \textbf{Backend API} : D√©marrer le serveur backend
    \item \textbf{Configuration} : Variables d'environnement
    \item \textbf{Authentification} : Gestion des tokens JWT
\end{enumerate}

\section{√âtapes de Migration}

\subsection{1. Configuration Backend}

\begin{lstlisting}[language=bash, caption=Configuration environnement]
# Variables d'environnement
API_BASE_URL=http://localhost:8001
JWT_SECRET=your-secret-key
PROXMOX_HOST=192.168.1.100
PROXMOX_USER=root@pam
PROXMOX_PASSWORD=your-password
\end{lstlisting}

\subsection{2. Modification du Contr√¥leur}

\begin{lstlisting}[language=PHP, caption=Contr√¥leur en mode dynamique]
#[Route('/vm/{vmid}', name: 'app_vm_details')]
public function details(int $vmid): Response
{
    // Mode dynamique : donn√©es via API
    return $this->render('vm/details.html.twig', [
        'vmid' => $vmid,
        'api_base_url' => $_ENV['API_BASE_URL'] ?? 'http://localhost:8001',
    ]);
}
\end{lstlisting}

\subsection{3. Activation du JavaScript}

\begin{lstlisting}[language=HTML, caption=Template en mode dynamique]
<!-- D√©commenter les sections JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const VMID = {{ vmid }};
const API_BASE_URL = '{{ api_base_url }}';
const api = new ApiService(API_BASE_URL);

// Chargement des donn√©es via API
async function loadVMData() {
    try {
        const vmResponse = await api.getVMs();
        const vm = vmResponse.data.find(v => v.vmid === VMID);
        
        if (vm) {
            updateVMInfo(vm);
            await loadSnapshots();
            initializeCharts(vm);
            connectEventStream();
        }
    } catch (error) {
        console.error('Erreur chargement donn√©es:', error);
    }
}

// Initialisation au chargement de la page
document.addEventListener('DOMContentLoaded', loadVMData);
</script>
\end{lstlisting}

\subsection{4. Service API Backend}

\begin{lstlisting}[language=PHP, caption=Endpoints API backend]
#[Route('/api/v1/vms', methods: ['GET'])]
public function getVMs(): JsonResponse
{
    $vms = $this->proxmoxService->getAllVMs();
    return $this->json(['success' => true, 'data' => $vms]);
}

#[Route('/api/v1/vms/{vmid}', methods: ['GET'])]
public function getVM(int $vmid): JsonResponse
{
    $vm = $this->proxmoxService->getVM($vmid);
    return $this->json(['success' => true, 'data' => $vm]);
}

#[Route('/api/v1/vms/{vmid}/start', methods: ['POST'])]
public function startVM(int $vmid): JsonResponse
{
    $result = $this->proxmoxService->startVM($vmid);
    return $this->json(['success' => $result]);
}
\end{lstlisting}

\section{Avantages du Mode Dynamique}

\subsection{Fonctionnalit√©s Activ√©es}

\begin{itemize}
    \item \textbf{Donn√©es temps r√©el} : M√©triques actualis√©es automatiquement
    \item \textbf{Actions interactives} : D√©marrage/arr√™t des VMs
    \item \textbf{Graphiques dynamiques} : √âvolution des performances
    \item \textbf{√âv√©nements en direct} : Flux SSE des op√©rations
    \item \textbf{Gestion des snapshots} : Cr√©ation et restauration
\end{itemize}

\subsection{Performance et Monitoring}

\begin{itemize}
    \item \textbf{Temps de r√©ponse} : < 2 secondes
    \item \textbf{Mise √† jour automatique} : Toutes les 5 secondes
    \item \textbf{Gestion d'erreurs} : Retry automatique
    \item \textbf{Authentification} : JWT avec renouvellement
\end{itemize}

% ============================================================
% CHAPITRE 6 : COMPARAISON DES MODES
% ============================================================
\chapter{Comparaison des Modes}

\section{Tableau Comparatif}

\begin{table}[H]
\centering
\begin{tabular}{@{}p{3cm}p{6cm}p{6cm}@{}}
\toprule
\textbf{Aspect} & \textbf{Mode D√©monstration} & \textbf{Mode Dynamique} \\ \midrule
Donn√©es & Statiques (PHP) & Temps r√©el (API) \\
Configuration & Aucune & Backend requis \\
Performance & Instantan√©e & D√©pendante r√©seau \\
Fonctionnalit√©s & Affichage uniquement & Actions compl√®tes \\
D√©monstration & Parfaite & Compl√®te \\
Production & Non adapt√© & Recommand√© \\
Maintenance & Minimale & Standard \\
√âvolutivit√© & Limit√©e & Totale \\ \bottomrule
\end{tabular}
\caption{Comparaison des modes de fonctionnement}
\end{table}

\section{Recommandations}

\subsection{Mode D√©monstration}

\textbf{Utilisation recommand√©e :}
\begin{itemize}
    \item Pr√©sentations et d√©monstrations
    \item D√©veloppement d'interface
    \item Tests de design
    \item Formation utilisateurs
\end{itemize}

\subsection{Mode Dynamique}

\textbf{Utilisation recommand√©e :}
\begin{itemize}
    \item Environnement de production
    \item Gestion r√©elle des VMs
    \item Monitoring en continu
    \item Int√©gration avec infrastructure
\end{itemize}

% ============================================================
% CHAPITRE 7 : GUIDE DE MIGRATION
% ============================================================
\chapter{Guide de Migration}

\section{Checklist de Migration}

\subsection{Pr√©requis}

\begin{enumerate}
    \item \textbf{Serveur backend} : API Symfony configur√©e
    \item \textbf{Proxmox VE} : Infrastructure accessible
    \item \textbf{Authentification} : JWT configur√©
    \item \textbf{R√©seau} : Communication frontend/backend
\end{enumerate}

\subsection{√âtapes de Migration}

\begin{enumerate}
    \item \textbf{Configuration environnement} : Variables d'API
    \item \textbf{Modification contr√¥leur} : Suppression donn√©es statiques
    \item \textbf{Activation JavaScript} : D√©commenter le code
    \item \textbf{Test des fonctionnalit√©s} : V√©rification compl√®te
    \item \textbf{D√©ploiement} : Mise en production
\end{enumerate}

\section{Script de Migration}

\begin{lstlisting}[language=bash, caption=Script de migration automatique]
#!/bin/bash

echo "=== Migration vers le mode dynamique ==="

# 1. Configuration environnement
echo "Configuration des variables d'environnement..."
cp .env.example .env
echo "API_BASE_URL=http://localhost:8001" >> .env

# 2. Modification du contr√¥leur
echo "Modification du contr√¥leur..."
sed -i 's/\/\/ Mode d√©monstration/Mode dynamique/g' src/Controller/ListVMsController.php

# 3. Activation du JavaScript
echo "Activation du JavaScript..."
sed -i 's/<!-- <script>/<script>/g' templates/vm/details.html.twig
sed -i 's/<\/script> -->/<\/script>/g' templates/vm/details.html.twig

# 4. Test des fonctionnalit√©s
echo "Test des fonctionnalit√©s..."
php bin/console cache:clear

echo "=== Migration termin√©e ==="
\end{lstlisting}

% ============================================================
% CONCLUSION
% ============================================================
\chapter{Conclusion}

\section{Bilan des Fonctionnalit√©s}

Les fonctionnalit√©s \textbf{CreateVM} et \textbf{DetailsVM} offrent :

\begin{itemize}
    \item \textbf{Mode d√©monstration} : Interface compl√®te avec donn√©es statiques
    \item \textbf{Mode dynamique} : Fonctionnalit√©s temps r√©el avec API backend
    \item \textbf{Migration facile} : Passage simple entre les modes
    \item \textbf{Architecture flexible} : Adaptation aux besoins
\end{itemize}

\section{Perspectives d'√âvolution}

\begin{itemize}
    \item \textbf{Mode hybride} : Combinaison des deux approches
    \item \textbf{Cache intelligent} : Optimisation des performances
    \item \textbf{Offline mode} : Fonctionnement sans connexion
    \item \textbf{API avanc√©e} : Endpoints suppl√©mentaires
\end{itemize}

\begin{successbox}
Les fonctionnalit√©s CreateVM et DetailsVM constituent une base solide pour la gestion de machines virtuelles, avec une architecture flexible permettant l'adaptation aux diff√©rents contextes d'utilisation.
\end{successbox}

\end{document}